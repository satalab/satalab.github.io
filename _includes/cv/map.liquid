{%- assign sec = include.section | default: entry -%}
{%- assign items = include.content | default: sec.contents | default: entry.contents -%}

{%- assign has_profile_image = false -%}
{%- assign has_social = false -%}

{%- if sec and sec.profile_image -%}
  {%- assign has_profile_image = true -%}
{%- endif -%}

{%- if sec and sec.social and sec.social.size > 0 -%}
  {%- assign has_social = true -%}
{%- endif -%}

{% if has_profile_image or has_social %}
  <div class="cv-map-grid">
    <!-- LEFT: table -->
    <div class="cv-map-left">
      <table class="table table-cv table-sm table-borderless table-responsive">
        {% for content in items %}
          <tr>
            <td class="p-1 pr-2 font-weight-bold">
              <b>{{ content.name }}</b>
            </td>

            {% if content.value or content.icon_lines or content.icons %}
              <td class="p-1 pl-2 font-weight-light text">

                {% if content.value %}
                  {{ content.value }}
                {% endif %}

                {% if content.icon_lines %}
                  <div class="cv-icon-lines {% if content.value %}mt-2{% endif %}">
                    {% for it in content.icon_lines %}
                      {%- assign href = it.url | default: it.link -%}
                      {%- assign label = it.label | default: it.title | default: it.name -%}
                      {% if href and it.icon %}
                        <a
                          class="cv-icon-line-link"
                          href="{{ href }}"
                          target="_blank"
                          rel="noopener noreferrer"
                          aria-label="{{ label | default: 'link' }}"
                          data-tooltip="{{ label | default: '' | escape }}"
                        >
                          <span class="cv-icon-line-text">{{ label }}</span>
                          <i class="{{ it.icon }}"></i>
                        </a>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}

                {% if content.icons %}
                  <div class="cv-icon-row {% if content.value or content.icon_lines %}mt-2{% endif %}">
                    {% for icon_item in content.icons %}
                      {%- assign href2 = icon_item.url | default: icon_item.link -%}
                      {%- assign label2 = icon_item.title | default: icon_item.label | default: icon_item.name -%}
                      {% if href2 and icon_item.icon %}
                        <a
                          class="cv-icon-link"
                          href="{{ href2 }}"
                          target="_blank"
                          rel="noopener noreferrer"
                          aria-label="{{ label2 | default: 'social link' }}"
                          data-tooltip="{{ label2 | default: '' | escape }}"
                        >
                          <i class="{{ icon_item.icon }}"></i>
                        </a>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}

              </td>
            {% endif %}

            {% if content.links %}
              <td class="p-1 pl-2 font-weight-light text">
                <div class="container-pdf">
                  {% for item in content.links %}
                    {% if item.link %}
                      <div class="container-link-button">
                        {% if item.name %}
                          <a href="{{ item.link }}" target="_blank" class="btncv z-depth-0">{{ item.name }}</a>
                        {% else %}
                          <a href="{{ item.link }}" target="_blank" class="btncv z-depth-0">doc</a>
                        {% endif %}
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      </table>
    </div>

    <!-- RIGHT: profile image + section-level social icons -->
    <div class="cv-map-right">
      {% if has_profile_image %}
        {%- assign img_class = 'cv-profile-img z-depth-1' -%}
        {%- if sec.profile_image_circular -%}
          {%- assign img_class = img_class | append: ' rounded-circle' -%}
        {%- else -%}
          {%- assign img_class = img_class | append: ' rounded' -%}
        {%- endif -%}

        <img
          loading="eager"
          class="{{ img_class }}"
          src="{{ sec.profile_image | prepend: 'assets/img/' | relative_url }}"
          alt="{{ sec.profile_image_alt | default: 'Profile photo' }}"
        >
      {% endif %}

      {% if has_social %}
        <div class="cv-social">
          {% for s in sec.social %}
            {% if s.url and s.icon %}
              <a
                class="cv-social-link"
                href="{{ s.url }}"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="{{ s.title | default: 'social link' }}"
                data-tooltip="{{ s.title | default: '' | escape }}"
              >
                <i class="{{ s.icon }}"></i>
              </a>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

{% else %}
  <!-- fallback: original behavior (but icon_lines/icons also supported) -->
  <table class="table table-cv table-sm table-borderless table-responsive">
    {% for content in items %}
      <tr>
        <td class="p-1 pr-2 font-weight-bold">
          <b>{{ content.name }}</b>
        </td>

        {% if content.value or content.icon_lines or content.icons %}
          <td class="p-1 pl-2 font-weight-light text">

            {% if content.value %}
              {{ content.value }}
            {% endif %}

            {% if content.icon_lines %}
              <div class="cv-icon-lines {% if content.value %}mt-2{% endif %}">
                {% for it in content.icon_lines %}
                  {%- assign href = it.url | default: it.link -%}
                  {%- assign label = it.label | default: it.title | default: it.name -%}
                  {% if href and it.icon %}
                    <a
                      class="cv-icon-line-link"
                      href="{{ href }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      aria-label="{{ label | default: 'link' }}"
                      data-tooltip="{{ label | default: '' | escape }}"
                    >
                      <span class="cv-icon-line-text">{{ label }}</span>
                      <i class="{{ it.icon }}"></i>
                    </a>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}

            {% if content.icons %}
              <div class="cv-icon-row {% if content.value or content.icon_lines %}mt-2{% endif %}">
                {% for icon_item in content.icons %}
                  {%- assign href2 = icon_item.url | default: icon_item.link -%}
                  {%- assign label2 = icon_item.title | default: icon_item.label | default: icon_item.name -%}
                  {% if href2 and icon_item.icon %}
                    <a
                      class="cv-icon-link"
                      href="{{ href2 }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      aria-label="{{ label2 | default: 'social link' }}"
                      data-tooltip="{{ label2 | default: '' | escape }}"
                    >
                      <i class="{{ icon_item.icon }}"></i>
                    </a>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}

          </td>
        {% endif %}

        {% if content.links %}
          <td class="p-1 pl-2 font-weight-light text">
            <div class="container-pdf">
              {% for item in content.links %}
                {% if item.link %}
                  <div class="container-link-button">
                    {% if item.name %}
                      <a href="{{ item.link }}" target="_blank" class="btncv z-depth-0">{{ item.name }}</a>
                    {% else %}
                      <a href="{{ item.link }}" target="_blank" class="btncv z-depth-0">doc</a>
                    {% endif %}
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </td>
        {% endif %}
      </tr>
    {% endfor %}
  </table>
{% endif %}
